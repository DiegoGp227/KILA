// Prisma Schema — English standardized

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int      @id @default(autoincrement())
  username        String   @db.VarChar(100)
  email           String   @unique @db.VarChar(255)
  passwordHash    String   @map("password_hash") @db.VarChar(255)
  currency        String   @default("USD") @db.VarChar(10)
  budgetResetDay  Int      @default(1) @map("budget_reset_day")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  invoiceValidations InvoiceValidation[]

  @@map("users")
}

model InvoiceValidation {
  id             Int      @id @default(autoincrement())
  invoiceId      String   @map("invoice_id") @db.VarChar(100)
  userId         Int?     @map("user_id")
  validationDate DateTime @default(now()) @map("validation_date")
  passed         Boolean
  errors         Json     @default("[]")
  warnings       Json     @default("[]")
  invoiceData    Json     @map("invoice_data") // Quité el ? porque dijiste que necesitas guardar el JSON

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([invoiceId])
  @@index([validationDate(sort: Desc)])
  @@map("invoice_validations")
}
